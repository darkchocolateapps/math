<!DOCTYPE html>
<html lang="en">
<head>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-YE7B07Y8L0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-YE7B07Y8L0');
</script>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Back to Basics - Brain Gym Daily - Your Daily Mental Workout</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèãÔ∏è</text></svg>">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 5px;
        }

        .game-container {
            background: white;
            border-radius: 15px;
            padding: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 500px;
            width: 100%;
            max-height: 100vh;
            overflow-y: auto;
        }

        .compact-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding: 8px;
            background: #fff9e6;
            border-radius: 10px;
        }

        .header-left {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .app-name {
            font-size: 16px;
            font-weight: bold;
            color: #e67e22;
        }

        .streak-compact {
            font-size: 13px;
            color: #d68910;
            font-weight: 600;
        }

        .header-right {
            display: flex;
            gap: 6px;
        }

        .icon-button {
            background: #f39c12;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .icon-button:hover {
            background: #e67e22;
            transform: translateY(-1px);
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            background: #fff5f5;
            border-radius: 8px;
            margin-bottom: 8px;
            font-size: 12px;
        }

        .status-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }

        .status-label {
            color: #666;
            font-size: 11px;
        }

        .status-value {
            font-weight: bold;
            color: #c53030;
            font-size: 14px;
        }

        .score-board {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            padding: 20px;
            background: #f0f4ff;
            border-radius: 15px;
        }

        .score-item {
            text-align: center;
        }

        .score-label {
            font-size: 16px;
            color: #666;
            margin-bottom: 5px;
        }

        .score-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
        }

        .attempts-tracker {
            display: flex;
            justify-content: center;
            gap: 6px;
            margin-bottom: 10px;
        }

        .attempt-box {
            width: 40px;
            height: 40px;
            border: 2px solid #ddd;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }

        .attempt-box.correct {
            background: #c6f6d5;
            border-color: #48bb78;
            color: #22543d;
        }

        .attempt-box.incorrect {
            background: #fed7d7;
            border-color: #f56565;
            color: #742a2a;
        }

        .attempt-box.current {
            border-color: #f39c12;
            background: #fff9e6;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 10px;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 25px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-box {
            background: #fff9e6;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
        }

        .stat-number {
            font-size: 28px;
            font-weight: bold;
            color: #e67e22;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 12px;
            color: #666;
        }

        .distribution {
            margin-bottom: 20px;
        }

        .distribution-title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 12px;
            text-align: center;
        }

        .distribution-bar {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .bar-label {
            width: 25px;
            font-size: 14px;
            font-weight: bold;
            color: #666;
        }

        .bar-fill {
            background: #f39c12;
            height: 25px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            padding: 0 8px;
            color: white;
            font-weight: bold;
            min-width: 25px;
            transition: width 0.3s;
            font-size: 13px;
        }

        .close-button {
            background: #f39c12;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 25px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            transition: all 0.2s;
        }

        .close-button:hover {
            background: #e67e22;
        }

        .personal-records {
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 12px;
            text-align: center;
        }

        .records-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .record-item {
            background: #fff9e6;
            padding: 12px;
            border-radius: 10px;
            text-align: center;
        }

        .record-label {
            font-size: 11px;
            color: #666;
            margin-bottom: 5px;
        }

        .record-value {
            font-size: 20px;
            font-weight: bold;
            color: #e67e22;
        }

        .achievements-button {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            color: #fff;
            border: none;
            border-radius: 10px;
            padding: 12px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            transition: all 0.2s;
            box-shadow: 0 4px 10px rgba(230, 126, 34, 0.3);
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .achievements-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(230, 126, 34, 0.4);
        }

        .streak-calendar {
            margin-bottom: 20px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
            max-width: 300px;
            margin: 0 auto;
        }

        .calendar-day {
            aspect-ratio: 1;
            border-radius: 4px;
            background: #f0f0f0;
            transition: all 0.2s;
            position: relative;
        }

        .calendar-day.active {
            background: #48bb78;
        }

        .calendar-day.today {
            border: 2px solid #f39c12;
        }

        .calendar-day.future {
            background: #f9f9f9;
            opacity: 0.5;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .achievement-card {
            background: #fff9e6;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .achievement-card.unlocked {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            border-color: #fdcb6e;
            box-shadow: 0 4px 10px rgba(253, 203, 110, 0.4);
        }

        .achievement-card.locked {
            opacity: 0.5;
        }

        .achievement-icon {
            font-size: 36px;
            margin-bottom: 8px;
        }

        .achievement-name {
            font-size: 13px;
            font-weight: bold;
            color: #333;
            margin-bottom: 4px;
        }

        .achievement-desc {
            font-size: 10px;
            color: #666;
        }

        .completion-message {
            background: #c6f6d5;
            border: 3px solid #48bb78;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            margin-bottom: 15px;
        }

        .completion-title {
            font-size: 26px;
            font-weight: bold;
            color: #22543d;
            margin-bottom: 12px;
        }

        .completion-text {
            font-size: 16px;
            color: #22543d;
            margin-bottom: 15px;
        }

        .completion-time {
            font-size: 24px;
            color: #e67e22;
            font-weight: bold;
            margin: 15px 0;
            padding: 15px;
            background: #fff9e6;
            border-radius: 10px;
            border: 2px solid #f39c12;
        }

        .share-button {
            background: #48bb78;
            color: white;
            border: none;
            border-radius: 10px;
            padding: 12px 25px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 8px;
            transition: all 0.2s;
        }

        .share-button:hover {
            background: #38a169;
        }

        .problem-display {
            background: #f5f5f5;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 10px;
            text-align: center;
            border: 2px solid #f39c12;
            min-height: 70px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .problem-text {
            font-size: 28px;
            color: #333;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .problem-question {
            font-size: 13px;
            color: #555;
            margin-top: 3px;
        }

        .answer-input {
            font-size: 28px;
            padding: 12px;
            border: 2px solid #f39c12;
            border-radius: 12px;
            text-align: center;
            width: 100%;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .answer-input:focus {
            outline: none;
            border-color: #48bb78;
        }

        .number-pad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 10px;
        }

        .num-button {
            background: #f39c12;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 24px;
            padding: 14px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
        }

        .num-button:hover {
            background: #e67e22;
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .num-button:active {
            transform: translateY(0);
        }

        .control-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .submit-button {
            background: #48bb78;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            padding: 14px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
        }

        .submit-button:hover {
            background: #38a169;
            transform: translateY(-1px);
        }

        .clear-button {
            background: #f56565;
        }

        .clear-button:hover {
            background: #e53e3e;
        }

        .feedback {
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 10px;
            display: none;
        }

        .feedback.correct {
            background: #c6f6d5;
            color: #22543d;
            display: block;
        }

        .feedback.incorrect {
            background: #fed7d7;
            color: #742a2a;
            display: block;
        }

        .hidden {
            display: none;
        }

        @keyframes slideDown {
            from {
                transform: translate(-50%, -100%);
                opacity: 0;
            }
            to {
                transform: translate(-50%, 0);
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                transform: translate(-50%, 0);
                opacity: 1;
            }
            to {
                transform: translate(-50%, -100%);
                opacity: 0;
            }
        }

        .feedback-icon {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            font-size: 120px;
            z-index: 1500;
            animation: popIn 0.5s ease-out forwards;
        }

        .feedback-icon.correct {
            color: #48bb78;
            text-shadow: 0 0 30px rgba(72, 187, 120, 0.5);
        }

        .feedback-icon.incorrect {
            color: #f56565;
            text-shadow: 0 0 30px rgba(245, 101, 101, 0.5);
        }

        @keyframes popIn {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        .flash-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1400;
            pointer-events: none;
            opacity: 0;
        }

        .flash-overlay.correct {
            background: rgba(72, 187, 120, 0.3);
            animation: flash 0.5s ease-out;
        }

        .flash-overlay.incorrect {
            background: rgba(245, 101, 101, 0.3);
            animation: flash 0.3s ease-out;
        }

        @keyframes flash {
            0%, 100% {
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
        }

        @media (max-width: 600px) {
            .game-container {
                padding: 15px;
            }
            
            h1 {
                font-size: 20px;
            }

            .gym-icon {
                font-size: 24px;
                margin-right: 3px;
            }
            
            .problem-text {
                font-size: 28px;
            }

            .answer-input {
                font-size: 28px;
                padding: 12px;
            }
            
            .num-button {
                font-size: 24px;
                padding: 15px;
            }

            .submit-button {
                font-size: 16px;
                padding: 15px;
            }

            .attempt-box {
                width: 45px;
                height: 45px;
                font-size: 18px;
            }

            .modal-content {
                padding: 20px;
            }

            .stats-button {
                padding: 6px 12px;
                font-size: 14px;
            }

            .share-icon-button {
                padding: 6px 10px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="compact-header">
            <div class="header-left">
                <div class="app-name">üèãÔ∏è Brain Gym</div>
                <div class="streak-compact">üî• <span id="dailyStreak">0</span> day streak</div>
            </div>
            <div class="header-right">
                <button class="icon-button" onclick="shareApp()" title="Share App">üîó</button>
                <button class="icon-button" onclick="showStats()">üìä</button>
            </div>
        </div>

        <div class="status-bar">
            <div class="status-item">
                <span class="status-label">Problem:</span>
                <span class="status-value"><span id="currentProblem">1</span>/<span id="totalProblems">7</span></span>
            </div>
            <div class="status-item">
                <span class="status-label">‚è±Ô∏è</span>
                <span class="status-value" id="timerValue">0:00</span>
            </div>
            <div class="status-item">
                <span class="status-label">Record:</span>
                <span class="status-value" id="bestTime">--</span>
            </div>
        </div>

        <div class="attempts-tracker" id="attemptsTracker">
            <div class="attempt-box current">1</div>
            <div class="attempt-box">2</div>
            <div class="attempt-box">3</div>
        </div>

        <div class="feedback" id="feedback"></div>

        <div class="problem-display">
            <div class="problem-text" id="problemText">12 + 8 = ?</div>
            <div class="problem-question">What is the answer?</div>
        </div>

        <input type="text" class="answer-input" id="answerInput" readonly placeholder="Type your answer">

        <div class="number-pad">
            <button class="num-button" onclick="addDigit('7')">7</button>
            <button class="num-button" onclick="addDigit('8')">8</button>
            <button class="num-button" onclick="addDigit('9')">9</button>
            <button class="num-button" onclick="addDigit('4')">4</button>
            <button class="num-button" onclick="addDigit('5')">5</button>
            <button class="num-button" onclick="addDigit('6')">6</button>
            <button class="num-button" onclick="addDigit('1')">1</button>
            <button class="num-button" onclick="addDigit('2')">2</button>
            <button class="num-button" onclick="addDigit('3')">3</button>
            <button class="num-button" onclick="addDigit('0')">0</button>
            <button class="num-button" onclick="addDigit('.')">.</button>
            <button class="num-button clear-button" onclick="clearInput()">‚å´</button>
        </div>

        <div class="control-buttons">
            <button class="submit-button" onclick="checkAnswer()">‚úì Submit Answer</button>
            <button class="submit-button clear-button" onclick="skipProblem()">Skip ‚ûú</button>
        </div>

        <div id="completionSection" class="hidden">
            <div class="completion-message">
                <div class="completion-title">üéâ Workout Complete!</div>
                <div class="completion-text">You've completed today's mental workout!</div>
                <div class="completion-time" id="completionTime">‚è±Ô∏è Time: --</div>
                <div class="completion-text">Come back tomorrow to continue your streak!</div>
                <button class="share-button" onclick="shareResults()">üì§ Share Your Stats</button>
            </div>
        </div>
    </div>

    <!-- Statistics Modal -->
    <div id="statsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">üìä Your Statistics</div>
            </div>

            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-number" id="totalPlayed">0</div>
                    <div class="stat-label">Days Played</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="winPercentage">0%</div>
                    <div class="stat-label">Success Rate</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="currentStreakStat">0</div>
                    <div class="stat-label">Current Streak</div>
                </div>
                <div class="stat-box">
                    <div class="stat-number" id="maxStreak">0</div>
                    <div class="stat-label">Max Streak</div>
                </div>
            </div>

            <div class="personal-records">
                <div class="section-title">‚ö° Personal Records</div>
                <div class="records-grid">
                    <div class="record-item">
                        <div class="record-label">Fastest Time</div>
                        <div class="record-value" id="fastestTime">--</div>
                    </div>
                    <div class="record-item">
                        <div class="record-label">Perfect Games</div>
                        <div class="record-value" id="perfectGames">0</div>
                    </div>
                    <div class="record-item">
                        <div class="record-label">Total Problems</div>
                        <div class="record-value" id="totalProblems">0</div>
                    </div>
                    <div class="record-item">
                        <div class="record-label">Badges Earned</div>
                        <div class="record-value" id="badgesEarned">0</div>
                    </div>
                </div>
                <button class="achievements-button" onclick="showAchievements()">üèÜ View All Badges</button>
            </div>

            <div class="streak-calendar">
                <div class="section-title">üìÖ Activity Streak</div>
                <div id="calendarGrid" class="calendar-grid">
                    <!-- Calendar will be generated here -->
                </div>
            </div>

            <div class="distribution">
                <div class="distribution-title">Guess Distribution</div>
                <div class="distribution-bar">
                    <div class="bar-label">1</div>
                    <div class="bar-fill" id="bar1">0</div>
                </div>
                <div class="distribution-bar">
                    <div class="bar-label">2</div>
                    <div class="bar-fill" id="bar2">0</div>
                </div>
                <div class="distribution-bar">
                    <div class="bar-label">3</div>
                    <div class="bar-fill" id="bar3">0</div>
                </div>
                <div class="distribution-bar">
                    <div class="bar-label">‚ùå</div>
                    <div class="bar-fill" id="barFailed" style="background: #f56565;">0</div>
                </div>
            </div>

            <button class="close-button" onclick="closeStats()">Close</button>
        </div>
    </div>

    <!-- Achievements Modal -->
    <div id="achievementsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">üèÜ Achievements</div>
            </div>

            <div class="achievements-grid" id="achievementsGrid">
                <!-- Achievements will be dynamically added here -->
            </div>

            <button class="close-button" onclick="closeAchievements()">Close</button>
        </div>
    </div>

    <script>
        // Game state
        let currentAnswer = 0;
        let userInput = '';
        let currentAttempt = 1;
        let currentProblemIndex = 0;
        const PROBLEMS_PER_DAY = 7;
        let startTime = null;
        let timerInterval = null;
        let finalTime = 0;
        
        // Storage keys
        const STORAGE_KEYS = {
            stats: 'mathGameStats',
            today: 'mathGameToday',
            lastPlayed: 'mathGameLastPlayed'
        };

        // Initialize or load stats
        function initStats() {
            const defaultStats = {
                gamesPlayed: 0,
                gamesWon: 0,
                currentStreak: 0,
                maxStreak: 0,
                guessDistribution: { 1: 0, 2: 0, 3: 0, failed: 0 },
                totalProblems: 0,
                problemsCorrect: 0,
                fastestTime: null,
                perfectGames: 0,
                playedDates: [], // Array of date strings
                achievements: []
            };
            
            const stored = localStorage.getItem(STORAGE_KEYS.stats);
            return stored ? {...defaultStats, ...JSON.parse(stored)} : defaultStats;
        }

        // Define achievements
        const ACHIEVEMENTS = [
            { id: 'first_win', icon: 'üéØ', name: 'First Victory', desc: 'Complete your first workout' },
            { id: 'perfect_game', icon: 'üíØ', name: 'Perfectionist', desc: 'All correct on first try' },
            { id: 'speed_demon', icon: '‚ö°', name: 'Speed Demon', desc: 'Complete in under 2 minutes' },
            { id: 'week_streak', icon: 'üî•', name: 'Week Warrior', desc: 'Maintain 7 day streak' },
            { id: 'month_streak', icon: 'üëë', name: 'Month Master', desc: 'Maintain 30 day streak' },
            { id: 'hundred_club', icon: 'üí™', name: 'Century Club', desc: 'Solve 100 problems' },
            { id: 'dedicated', icon: 'üèÜ', name: 'Dedicated', desc: 'Play 10 days' },
            { id: 'consistent', icon: '‚≠ê', name: 'Consistent', desc: 'Play 30 days' }
        ];

        function checkAchievements(stats, todayData) {
            const newAchievements = [];
            
            // First Victory
            if (stats.gamesPlayed >= 1 && !stats.achievements.includes('first_win')) {
                newAchievements.push('first_win');
            }
            
            // Perfect Game
            const allFirstTry = todayData.results.every(r => r.correct && r.attempts === 1);
            if (allFirstTry && todayData.results.length === PROBLEMS_PER_DAY && !stats.achievements.includes('perfect_game')) {
                newAchievements.push('perfect_game');
                stats.perfectGames++;
            }
            
            // Speed Demon
            if (todayData.timeInSeconds && todayData.timeInSeconds < 120 && !stats.achievements.includes('speed_demon')) {
                newAchievements.push('speed_demon');
            }
            
            // Week Streak
            if (stats.currentStreak >= 7 && !stats.achievements.includes('week_streak')) {
                newAchievements.push('week_streak');
            }
            
            // Month Streak
            if (stats.currentStreak >= 30 && !stats.achievements.includes('month_streak')) {
                newAchievements.push('month_streak');
            }
            
            // Century Club
            if (stats.totalProblems >= 100 && !stats.achievements.includes('hundred_club')) {
                newAchievements.push('hundred_club');
            }
            
            // Dedicated
            if (stats.gamesPlayed >= 10 && !stats.achievements.includes('dedicated')) {
                newAchievements.push('dedicated');
            }
            
            // Consistent
            if (stats.gamesPlayed >= 30 && !stats.achievements.includes('consistent')) {
                newAchievements.push('consistent');
            }
            
            // Add new achievements
            stats.achievements = [...new Set([...stats.achievements, ...newAchievements])];
            
            // Show notification for new achievements
            if (newAchievements.length > 0) {
                showAchievementNotification(newAchievements);
            }
            
            return stats;
        }

        function showAchievementNotification(achievementIds) {
            const achievement = ACHIEVEMENTS.find(a => a.id === achievementIds[0]);
            if (achievement) {
                const notification = document.createElement('div');
                notification.className = 'achievement-notification';
                notification.innerHTML = `
                    <div style="font-size: 40px;">${achievement.icon}</div>
                    <div style="font-weight: bold; font-size: 16px;">Achievement Unlocked!</div>
                    <div style="font-size: 14px;">${achievement.name}</div>
                `;
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
                    padding: 20px;
                    border-radius: 15px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    z-index: 2000;
                    text-align: center;
                    animation: slideDown 0.5s ease;
                `;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.style.animation = 'slideUp 0.5s ease';
                    setTimeout(() => notification.remove(), 500);
                }, 3000);
            }
        }

        function saveStats(stats) {
            localStorage.setItem(STORAGE_KEYS.stats, JSON.stringify(stats));
        }

        function getTodayString() {
            const today = new Date();
            return `${today.getFullYear()}-${today.getMonth() + 1}-${today.getDate()}`;
        }

        function getTodayData() {
            const stored = localStorage.getItem(STORAGE_KEYS.today);
            const today = getTodayString();
            
            if (stored) {
                const data = JSON.parse(stored);
                if (data.date === today) {
                    return data;
                }
            }
            
            // New day, reset
            return {
                date: today,
                problemsCompleted: 0,
                results: [],
                completed: false,
                timeInSeconds: 0
            };
        }

        function startTimer() {
            if (!startTime) {
                startTime = Date.now();
                timerInterval = setInterval(updateTimer, 100);
            }
        }

        function updateTimer() {
            if (startTime) {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('timerValue').textContent = 
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
                if (startTime) {
                    finalTime = Math.floor((Date.now() - startTime) / 1000);
                }
            }
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        }

        function showAnimatedFeedback(isCorrect, message) {
            // Create flash overlay
            const flash = document.createElement('div');
            flash.className = `flash-overlay ${isCorrect ? 'correct' : 'incorrect'}`;
            document.body.appendChild(flash);
            
            // Create large icon
            const icon = document.createElement('div');
            icon.className = `feedback-icon ${isCorrect ? 'correct' : 'incorrect'}`;
            icon.textContent = isCorrect ? '‚úì' : '‚úó';
            document.body.appendChild(icon);
            
            // Update text feedback
            const feedback = document.getElementById('feedback');
            feedback.className = `feedback ${isCorrect ? 'correct' : 'incorrect'}`;
            feedback.textContent = message;
            
            // Remove after animation
            setTimeout(() => {
                flash.remove();
                icon.remove();
            }, 500);
        }

        function saveTodayData(data) {
            localStorage.setItem(STORAGE_KEYS.today, JSON.stringify(data));
        }

        function updateStreak() {
            const stats = initStats();
            const lastPlayed = localStorage.getItem(STORAGE_KEYS.lastPlayed);
            const today = getTodayString();
            
            if (lastPlayed) {
                const last = new Date(lastPlayed);
                const current = new Date(today);
                const diffTime = Math.abs(current - last);
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                if (diffDays === 1) {
                    stats.currentStreak++;
                } else if (diffDays > 1) {
                    stats.currentStreak = 1;
                }
            } else {
                stats.currentStreak = 1;
            }
            
            stats.maxStreak = Math.max(stats.maxStreak, stats.currentStreak);
            localStorage.setItem(STORAGE_KEYS.lastPlayed, today);
            saveStats(stats);
            
            return stats.currentStreak;
        }

        function updateDisplay() {
            const todayData = getTodayData();
            const stats = initStats();
            
            document.getElementById('dailyStreak').textContent = stats.currentStreak;
            // Cap the display at PROBLEMS_PER_DAY to prevent overflow
            const currentProblemNum = Math.min(todayData.problemsCompleted + 1, PROBLEMS_PER_DAY);
            document.getElementById('currentProblem').textContent = currentProblemNum;
            document.getElementById('totalProblems').textContent = PROBLEMS_PER_DAY;
            
            // Update best time
            const bestTimeElement = document.getElementById('bestTime');
            if (stats.fastestTime) {
                bestTimeElement.textContent = formatTime(stats.fastestTime);
            } else {
                bestTimeElement.textContent = '--';
            }
            
            // Check if today's practice is complete
            if (todayData.completed || todayData.problemsCompleted >= PROBLEMS_PER_DAY) {
                showCompletion();
            }
        }

        function updateAttemptsDisplay() {
            const boxes = document.querySelectorAll('.attempt-box');
            boxes.forEach((box, index) => {
                box.className = 'attempt-box';
                if (index + 1 < currentAttempt) {
                    box.classList.add('incorrect');
                    box.textContent = '‚ùå';
                } else if (index + 1 === currentAttempt) {
                    box.classList.add('current');
                    box.textContent = index + 1;
                } else {
                    box.textContent = index + 1;
                }
            });
        }

        const operations = ['+', '-', '√ó', '√∑', '%'];

        function generateProblem() {
            // Start timer on first problem
            if (currentProblemIndex === 0 && !startTime) {
                startTimer();
            }

            const operation = operations[Math.floor(Math.random() * operations.length)];
            let num1, num2, answer, problemText;

            // Generate numbers
            num1 = Math.floor(Math.random() * 30) + 5;
            num2 = Math.floor(Math.random() * 30) + 5;

            switch(operation) {
                case '+':
                    answer = num1 + num2;
                    problemText = `${num1} + ${num2} = ?`;
                    break;
                case '-':
                    if (num1 < num2) [num1, num2] = [num2, num1];
                    answer = num1 - num2;
                    problemText = `${num1} - ${num2} = ?`;
                    break;
                case '√ó':
                    // Exclude 1, 10, and 100
                    do {
                        num1 = Math.floor(Math.random() * 10) + 2;
                        num2 = Math.floor(Math.random() * 10) + 2;
                    } while (num1 === 10 || num2 === 10 || num1 === 1 || num2 === 1);
                    
                    answer = num1 * num2;
                    problemText = `${num1} √ó ${num2} = ?`;
                    break;
                case '√∑':
                    // Exclude 1, 10, and 100 as divisors
                    do {
                        num2 = Math.floor(Math.random() * 9) + 2;
                    } while (num2 === 10 || num2 === 1);
                    
                    answer = Math.floor(Math.random() * 15) + 2;
                    num1 = num2 * answer;
                    problemText = `${num1} √∑ ${num2} = ?`;
                    break;
                case '%':
                    num1 = [10, 20, 25, 50, 75][Math.floor(Math.random() * 5)];
                    num2 = Math.floor(Math.random() * 10) * 10 + 10;
                    answer = (num1 / 100) * num2;
                    // Round to 1 decimal place for display
                    answer = Math.round(answer * 10) / 10;
                    problemText = `What is ${num1}% of ${num2}?`;
                    break;
            }

            currentAnswer = answer;
            currentAttempt = 1;
            document.getElementById('problemText').textContent = problemText;
            clearInput();
            document.getElementById('feedback').style.display = 'none';
            updateAttemptsDisplay();
        }

        function addDigit(digit) {
            if (digit === '.' && userInput.includes('.')) return;
            userInput += digit;
            document.getElementById('answerInput').value = userInput;
        }

        function clearInput() {
            userInput = '';
            document.getElementById('answerInput').value = '';
        }

        function checkAnswer() {
            const todayData = getTodayData();
            if (todayData.completed || todayData.problemsCompleted >= PROBLEMS_PER_DAY) {
                return;
            }
            
            if (userInput === '') return;

            const userAnswer = parseFloat(userInput);
            const stats = initStats();

            if (Math.abs(userAnswer - currentAnswer) < 0.1) {
                // Correct!
                showAnimatedFeedback(true, `‚úì Correct! The answer is ${currentAnswer}`);
                
                const boxes = document.querySelectorAll('.attempt-box');
                boxes[currentAttempt - 1].classList.remove('current');
                boxes[currentAttempt - 1].classList.add('correct');
                boxes[currentAttempt - 1].textContent = '‚úì';
                
                // Update stats
                stats.guessDistribution[currentAttempt]++;
                stats.problemsCorrect++;
                stats.totalProblems++;
                saveStats(stats);
                
                // Save today's result
                todayData.results.push({ attempts: currentAttempt, correct: true });
                todayData.problemsCompleted++;
                saveTodayData(todayData);
                
                updateDisplay();

                // Longer delay so user sees correct answer and transition
                setTimeout(() => {
                    if (todayData.problemsCompleted >= PROBLEMS_PER_DAY) {
                        completeDailyPractice();
                    } else {
                        generateProblem();
                    }
                }, 1500);
            } else {
                // Incorrect
                if (currentAttempt < 3) {
                    currentAttempt++;
                    showAnimatedFeedback(false, `Try again! You have ${4 - currentAttempt} attempt${4 - currentAttempt > 1 ? 's' : ''} left.`);
                    updateAttemptsDisplay();
                    clearInput();
                } else {
                    // Failed after 3 attempts
                    showAnimatedFeedback(false, `The correct answer was ${currentAnswer}`);
                    
                    const boxes = document.querySelectorAll('.attempt-box');
                    boxes[2].classList.remove('current');
                    boxes[2].classList.add('incorrect');
                    boxes[2].textContent = '‚ùå';
                    
                    // Update stats
                    stats.guessDistribution.failed++;
                    stats.totalProblems++;
                    saveStats(stats);
                    
                    // Save today's result
                    todayData.results.push({ attempts: 3, correct: false });
                    todayData.problemsCompleted++;
                    saveTodayData(todayData);
                    
                    updateDisplay();

                    // Show correct answer longer before moving on
                    setTimeout(() => {
                        if (todayData.problemsCompleted >= PROBLEMS_PER_DAY) {
                            completeDailyPractice();
                        } else {
                            generateProblem();
                        }
                    }, 2000);
                }
            }
        }

        function skipProblem() {
            const todayData = getTodayData();
            if (todayData.completed || todayData.problemsCompleted >= PROBLEMS_PER_DAY) {
                return;
            }
            
            const stats = initStats();
            stats.guessDistribution.failed++;
            stats.totalProblems++;
            saveStats(stats);
            
            todayData.results.push({ attempts: 0, correct: false });
            todayData.problemsCompleted++;
            saveTodayData(todayData);
            
            updateDisplay();
            
            if (todayData.problemsCompleted >= PROBLEMS_PER_DAY) {
                completeDailyPractice();
            } else {
                generateProblem();
            }
        }

        function completeDailyPractice() {
            stopTimer();
            
            const todayData = getTodayData();
            todayData.completed = true;
            todayData.timeInSeconds = finalTime;
            saveTodayData(todayData);
            
            const stats = initStats();
            stats.gamesPlayed++;
            
            // Track fastest time
            if (!stats.fastestTime || finalTime < stats.fastestTime) {
                stats.fastestTime = finalTime;
            }
            
            // Add today to played dates
            const today = getTodayString();
            if (!stats.playedDates.includes(today)) {
                stats.playedDates.push(today);
            }
            
            // Check if they got at least half correct
            const correctCount = todayData.results.filter(r => r.correct).length;
            if (correctCount >= PROBLEMS_PER_DAY / 2) {
                stats.gamesWon++;
            }
            
            // Check for achievements
            checkAchievements(stats, todayData);
            
            saveStats(stats);
            updateStreak();
            showCompletion();
        }

        function showCompletion() {
            document.getElementById('completionSection').classList.remove('hidden');
            document.querySelector('.number-pad').style.display = 'none';
            document.querySelector('.control-buttons').style.display = 'none';
            document.querySelector('.problem-display').style.display = 'none';
            document.querySelector('.attempts-tracker').style.display = 'none';
            document.querySelector('.status-bar').style.display = 'none';
            const answerInput = document.querySelector('.answer-input');
            answerInput.style.display = 'none';
            answerInput.classList.add('hidden');
            document.getElementById('feedback').style.display = 'none';
            
            // Display the time taken
            const todayData = getTodayData();
            const timeStr = formatTime(todayData.timeInSeconds || finalTime);
            document.getElementById('completionTime').textContent = `‚è±Ô∏è It took you ${timeStr} today!`;
            
            // Clear the problem text
            document.getElementById('problemText').textContent = '';
            document.getElementById('answerInput').value = '';
        }

        function shareResults() {
            const todayData = getTodayData();
            const stats = initStats();
            const correctCount = todayData.results.filter(r => r.correct).length;
            const timeStr = formatTime(todayData.timeInSeconds || finalTime);
            
            let shareText = `üèãÔ∏è Brain Gym Daily ${getTodayString()}\n`;
            shareText += `Score: ${correctCount}/${PROBLEMS_PER_DAY}\n`;
            shareText += `Time: ${timeStr}\n`;
            shareText += `Streak: ${stats.currentStreak} üî•\n\n`;
            
            todayData.results.forEach((result, index) => {
                if (result.correct) {
                    shareText += result.attempts === 1 ? 'üü¢' : result.attempts === 2 ? 'üü°' : 'üü†';
                } else {
                    shareText += '‚ö´';
                }
                if ((index + 1) % 5 === 0) shareText += '\n';
            });
            
            shareText += `\n\nTry it yourself: ${window.location.href}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Brain Gym Daily',
                    text: shareText
                }).catch(() => {
                    // Fallback to clipboard
                    copyToClipboard(shareText, 'Stats copied to clipboard!');
                });
            } else {
                copyToClipboard(shareText, 'Stats copied to clipboard!');
            }
        }

        function shareApp() {
            const appUrl = window.location.href;
            const shareText = `Check out Brain Gym Daily - Your daily mental workout!\n\n${appUrl}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Brain Gym Daily',
                    text: 'Check out Brain Gym Daily - Your daily mental workout!',
                    url: appUrl
                }).catch(() => {
                    // Fallback to clipboard
                    copyToClipboard(appUrl, 'App link copied to clipboard!');
                });
            } else {
                copyToClipboard(appUrl, 'App link copied to clipboard!');
            }
        }

        function copyToClipboard(text, message) {
            navigator.clipboard.writeText(text).then(() => {
                alert(message);
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                alert(message);
            });
        }

        function showStats() {
            const stats = initStats();
            const modal = document.getElementById('statsModal');
            
            document.getElementById('totalPlayed').textContent = stats.gamesPlayed;
            const winRate = stats.gamesPlayed > 0 ? Math.round((stats.gamesWon / stats.gamesPlayed) * 100) : 0;
            document.getElementById('winPercentage').textContent = winRate + '%';
            document.getElementById('currentStreakStat').textContent = stats.currentStreak;
            document.getElementById('maxStreak').textContent = stats.maxStreak;
            
            // Personal Records
            document.getElementById('fastestTime').textContent = stats.fastestTime ? formatTime(stats.fastestTime) : '--';
            document.getElementById('perfectGames').textContent = stats.perfectGames || 0;
            document.getElementById('totalProblems').textContent = stats.totalProblems || 0;
            document.getElementById('badgesEarned').textContent = stats.achievements.length;
            
            // Update guess distribution
            const maxGuesses = Math.max(
                stats.guessDistribution[1],
                stats.guessDistribution[2],
                stats.guessDistribution[3],
                stats.guessDistribution.failed,
                1
            );
            
            for (let i = 1; i <= 3; i++) {
                const bar = document.getElementById(`bar${i}`);
                const count = stats.guessDistribution[i];
                const width = (count / maxGuesses) * 100;
                bar.style.width = Math.max(width, 10) + '%';
                bar.textContent = count;
            }
            
            const failedBar = document.getElementById('barFailed');
            const failedCount = stats.guessDistribution.failed;
            const failedWidth = (failedCount / maxGuesses) * 100;
            failedBar.style.width = Math.max(failedWidth, 10) + '%';
            failedBar.textContent = failedCount;
            
            // Generate streak calendar (last 28 days)
            generateStreakCalendar(stats.playedDates);
            
            modal.classList.add('show');
        }

        function generateStreakCalendar(playedDates) {
            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';
            
            const today = new Date();
            const daysToShow = 28;
            
            for (let i = daysToShow - 1; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateString = `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`;
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                if (playedDates.includes(dateString)) {
                    dayElement.classList.add('active');
                }
                
                if (i === 0) {
                    dayElement.classList.add('today');
                }
                
                calendarGrid.appendChild(dayElement);
            }
        }

        function showAchievements() {
            const stats = initStats();
            const modal = document.getElementById('achievementsModal');
            const grid = document.getElementById('achievementsGrid');
            
            grid.innerHTML = '';
            
            ACHIEVEMENTS.forEach(achievement => {
                const isUnlocked = stats.achievements.includes(achievement.id);
                const card = document.createElement('div');
                card.className = `achievement-card ${isUnlocked ? 'unlocked' : 'locked'}`;
                card.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div class="achievement-name">${achievement.name}</div>
                    <div class="achievement-desc">${achievement.desc}</div>
                `;
                grid.appendChild(card);
            });
            
            modal.classList.add('show');
        }

        function closeAchievements() {
            document.getElementById('achievementsModal').classList.remove('show');
        }

        function closeStats() {
            document.getElementById('statsModal').classList.remove('show');
        }

        // Close modal when clicking outside
        document.getElementById('statsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeStats();
            }
        });

        document.getElementById('achievementsModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeAchievements();
            }
        });

        // Keyboard support
        document.addEventListener('keypress', function(e) {
            if (e.key >= '0' && e.key <= '9' || e.key === '.') {
                addDigit(e.key);
            } else if (e.key === 'Enter') {
                checkAnswer();
            }
        });

        document.addEventListener('keydown', function(e) {
            if (e.key === 'Backspace') {
                userInput = userInput.slice(0, -1);
                document.getElementById('answerInput').value = userInput;
            }
        });

        // Initialize game
        updateDisplay();
        const todayData = getTodayData();
        if (!todayData.completed && todayData.problemsCompleted < PROBLEMS_PER_DAY) {
            generateProblem();
        }
    </script>
</body>
</html>
